{% load leaflet_tags %}
{% load geojson_tags %}

{% block extra_assets %}
    {% leaflet_js %}
    {% leaflet_css %}
{% endblock %}

{% block content %}
    <html>
        <style>
            .leaflet-container {  /* all maps */
                width:  100%;
                height: 100%;
            }

            body {
                padding: 0;
                margin: 0;
            }
        </style>

        <body>
            <h1>Vehicle Tracking</h1>
        
            <script type="text/javascript">
                var waypoints = {{ waypoints|geojsonfeature:"start_location,popup_content"|safe }};

                
                function main_map_init(map, options) {

                    // place makers
                    var markers = [];
                    var features = waypoints.features;
                    for (i = 0; i < features.length; i++) {
                        var location = features[i].properties.start_location;
                        if (location != null) {
                            var marker = L.marker(location);
                            marker.bindPopup(features[i].properties.popup_content)
                            marker.addTo(map);
                            markers.push(marker);
                        }
                    }
                    
                    // draw waypoints                    
                    var lineStyle = {
                        "color": "Red",
                        "weight": 5,
                        "opacity": 0.65
                    };
                    
                    var tracks = L.geoJson(waypoints, {
                        style: lineStyle
                    });

                    // set map viewport
                    var group = new L.featureGroup([tracks]);
                    map.fitBounds(group.getBounds());
                    tracks.addTo(map);

                }
            </script>
            
        </body>

        {% leaflet_map "main" callback="main_map_init" %}

    </html>
{% endblock %}
